#!/bin/sh

ANSIBLE_VERSION='2.10.7'
ANSIBLE_LINT_VERSION='5.1.3'

DOCKER_BUILDX=$(docker buildx create --append --name ansible_${ANSIBLE_VERSION} --driver docker-container --use)
docker buildx build \
  --pull \
  --push \
  --provenance=false \
  --build-arg ANSIBLE_VERSION \
  --build-arg ANSIBLE_LINT_VERSION \
  --build-arg BUILD_DATE="$(date '+%FT%T.%s%z')" \
  --platform=linux/arm64,linux/amd64,linux/arm/v7 \
  -t ${IMAGE_NAME:=pad92/ansible-alpine:2.10.7-2} \
  -t registry.gitlab.com/pad92/docker-ansible-alpine:2.10.7-2 \
  .
